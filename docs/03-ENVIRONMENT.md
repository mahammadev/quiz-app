# Environment Variables

> Complete reference for all environment variables
> **Last Updated**: 2026-02-04

---

## Quick Reference

| Variable | Required | Service | Section |
|----------|----------|---------|---------|
| `NEXT_PUBLIC_CONVEX_URL` | ✅ Yes | Convex | [Database](#convex) |
| `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY` | ✅ Yes | Clerk | [Auth](#clerk-authentication) |
| `CLERK_SECRET_KEY` | ✅ Yes | Clerk | [Auth](#clerk-authentication) |
| `GOOGLE_AI_API_KEY` | ⚠️ Optional | Google AI | [AI Generation](#google-ai) |
| `STRIPE_SECRET_KEY` | ❌ No | Stripe | [Payments](#stripe-payments) |
| `STRIPE_WEBHOOK_SECRET` | ❌ No | Stripe | [Payments](#stripe-payments) |

---

## Required Variables

### Convex (Database)

#### `NEXT_PUBLIC_CONVEX_URL`

**Purpose**: Connection URL for Convex database

**Required**: ✅ Yes

**Format**: `https://<project-name>.convex.cloud`

**How to Get**:
```bash
npx convex dev
# Or check Convex dashboard
```

**Example**:
```bash
NEXT_PUBLIC_CONVEX_URL=https://muddy-tiger-123.convex.cloud
```

**What Happens If Missing**:
```
Error: Missing NEXT_PUBLIC_CONVEX_URL environment variable
App crashes on startup
```

**Notes**:
- Must start with `NEXT_PUBLIC_` to be available in browser
- Different for development vs production
- Auto-generated by Convex CLI

---

### Clerk Authentication

#### `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY`

**Purpose**: Public API key for Clerk authentication (frontend)

**Required**: ✅ Yes

**Format**: `pk_test_...` (development) or `pk_live_...` (production)

**How to Get**:
1. Go to [Clerk Dashboard](https://dashboard.clerk.com)
2. Select your application
3. Go to API Keys
4. Copy "Publishable key"

**Example**:
```bash
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_Y2xlcmsuaW5kdXN0cmFsLWFudC0xNy5jbGVyay5hY2NvdW50cy5kZXYk
```

**What Happens If Missing**:
```
Error: Missing Clerk publishable key
Sign-in/sign-up buttons won't work
```

**Security Notes**:
- Safe to expose in frontend (hence `NEXT_PUBLIC_`)
- Can be rotated if compromised
- Different keys for dev/production

---

#### `CLERK_SECRET_KEY`

**Purpose**: Secret key for Clerk authentication (backend/API)

**Required**: ✅ Yes

**Format**: `sk_test_...` (development) or `sk_live_...` (production)

**How to Get**:
1. Clerk Dashboard → API Keys
2. Copy "Secret key"
3. Keep this private!

**Example**:
```bash
CLERK_SECRET_KEY=sk_test_abc123xyz789...
```

**What Happens If Missing**:
```
Error: Missing Clerk secret key
API routes fail authentication
Server-side auth checks fail
```

**Security Notes**:
- ⚠️ **NEVER expose in frontend**
- No `NEXT_PUBLIC_` prefix
- Rotate immediately if leaked
- Store in secure environment only

---

## Optional Variables

### Google AI

#### `GOOGLE_AI_API_KEY`

**Purpose**: API key for Google Gemini (AI quiz generation)

**Required**: ⚠️ Optional (but AI features won't work without it)

**Format**: `AIza...` (alphanumeric string)

**How to Get**:
1. Go to [Google AI Studio](https://aistudio.google.com/app/apikey)
2. Sign in with Google account
3. Click "Create API Key"
4. Copy the key

**Example**:
```bash
GOOGLE_AI_API_KEY=AIzaSyB1234567890abcdef...
```

**What Happens If Missing**:
```
AI generation features return 503 error
User sees: "AI service not configured"
Other features work normally
```

**Quota & Pricing**:
- Free tier: 60 requests/minute, generous monthly limit
- Paid tier: $0.075 per 1M input tokens (Flash model)
- Monitor usage in Google Cloud Console

**Security Notes**:
- Should NOT have `NEXT_PUBLIC_` prefix
- API routes only (server-side)
- Rotate if you see unexpected usage

---

### Stripe Payments

#### `STRIKE_SECRET_KEY`

**Purpose**: Secret key for Stripe payment processing

**Required**: ❌ No (only for Phase 5: Monetization)

**Format**: `sk_test_...` (development) or `sk_live_...` (production)

**How to Get**:
1. Go to [Stripe Dashboard](https://dashboard.stripe.com)
2. Go to Developers → API Keys
3. Copy "Secret key"

**Example**:
```bash
STRIPE_SECRET_KEY=sk_test_51H1234567890abcdef...
```

**What Happens If Missing**:
```
Payment features disabled
Pricing page shows "Coming Soon"
No errors, just limited functionality
```

**Security Notes**:
- ⚠️ **NEVER expose in frontend**
- No `NEXT_PUBLIC_` prefix
- Different keys for test vs live mode
- Live keys = real money, be careful!

---

#### `STRIPE_WEBHOOK_SECRET`

**Purpose**: Webhook secret for Stripe events (payment confirmations, etc.)

**Required**: ❌ No (only for Phase 5)

**Format**: `whsec_...`

**How to Get**:
1. Stripe Dashboard → Developers → Webhooks
2. Create endpoint: `https://yourdomain.com/api/webhooks/stripe`
3. Select events: `checkout.session.completed`, `invoice.payment_succeeded`, etc.
4. Copy "Signing secret"

**Example**:
```bash
STRIPE_WEBHOOK_SECRET=whsec_1234567890abcdef...
```

**What Happens If Missing**:
```
Stripe webhooks fail validation
Payment status not updated automatically
Users may not get Pro features after paying
```

**Webhook Events to Subscribe To**:
- `checkout.session.completed` - Payment successful
- `customer.subscription.created` - Subscription started
- `customer.subscription.deleted` - Subscription cancelled
- `invoice.payment_failed` - Payment failed

---

## Environment File Templates

### Development (.env.local)

```bash
# ==========================================
# REQUIRED: Convex (Database)
# Get from: npx convex dev
# ==========================================
NEXT_PUBLIC_CONVEX_URL=https://your-project.convex.cloud

# ==========================================
# REQUIRED: Clerk (Authentication)
# Get from: https://dashboard.clerk.com
# ==========================================
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_...
CLERK_SECRET_KEY=sk_test_...

# ==========================================
# OPTIONAL: Google AI (Quiz Generation)
# Get from: https://aistudio.google.com/app/apikey
# Without this, AI features return errors
# ==========================================
GOOGLE_AI_API_KEY=AIza...

# ==========================================
# OPTIONAL: Stripe (Payments - Phase 5)
# Get from: https://dashboard.stripe.com
# ==========================================
# STRIPE_SECRET_KEY=sk_test_...
# STRIPE_WEBHOOK_SECRET=whsec_...
```

### Production (.env.production or Vercel)

```bash
# ==========================================
# REQUIRED: Convex Production
# Different from development URL!
# ==========================================
NEXT_PUBLIC_CONVEX_URL=https://your-project.convex.cloud

# ==========================================
# REQUIRED: Clerk Production
# Use pk_live_ and sk_live_ keys
# ==========================================
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_live_...
CLERK_SECRET_KEY=sk_live_...

# ==========================================
# OPTIONAL: Google AI
# Same key works for dev and production
# ==========================================
GOOGLE_AI_API_KEY=AIza...

# ==========================================
# OPTIONAL: Stripe Production
# Use sk_live_ for real payments
# ==========================================
STRIPE_SECRET_KEY=sk_live_...
STRIPE_WEBHOOK_SECRET=whsec_...
```

---

## Environment Variable Best Practices

### 1. Never Commit Secrets

**✅ Good**:
```bash
# .gitignore
.env.local
.env.production
.env
```

**❌ Bad**:
```bash
# Don't do this!
git add .env.local
git commit -m "Add env vars"
```

### 2. Use .env.example for Templates

Keep `.env.example` in repo with dummy values:
```bash
NEXT_PUBLIC_CONVEX_URL=https://your-project.convex.cloud
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_...
CLERK_SECRET_KEY=sk_test_...
GOOGLE_AI_API_KEY=AIza...
```

### 3. Different Keys for Dev/Prod

| Service | Development | Production |
|---------|-------------|------------|
| Convex | `.cloud` URL | Same URL (or different project) |
| Clerk | `pk_test_`, `sk_test_` | `pk_live_`, `sk_live_` |
| Stripe | `sk_test_` | `sk_live_` |
| Google AI | Same key | Same key (quota shared) |

### 4. Naming Conventions

| Prefix | Visibility | Example |
|--------|-----------|---------|
| `NEXT_PUBLIC_` | Frontend + Backend | `NEXT_PUBLIC_CONVEX_URL` |
| No prefix | Backend only | `CLERK_SECRET_KEY` |

**Rule**: Only add `NEXT_PUBLIC_` if the variable is needed in browser code.

### 5. Validation on Startup

The app validates required env vars on startup:

```typescript
// Example validation (in lib/env.ts)
const required = [
  'NEXT_PUBLIC_CONVEX_URL',
  'NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY',
  'CLERK_SECRET_KEY'
]

required.forEach(key => {
  if (!process.env[key]) {
    throw new Error(`Missing required environment variable: ${key}`)
  }
})
```

### 6. Rotating Keys

If a key is compromised:

**Clerk**:
1. Dashboard → API Keys → Rotate
2. Update `.env.local`
3. Restart dev server
4. Test sign-in still works

**Convex**:
1. Cannot rotate URL easily
2. Contact Convex support if needed
3. Usually not a security issue

**Google AI**:
1. Google AI Studio → API Keys
2. Delete old key
3. Create new key
4. Update `.env.local`

**Stripe**:
1. Dashboard → Developers → API Keys
2. Click "Reveal test key" → "Revoke"
3. Create new key
4. Update `.env.local`

---

## Troubleshooting

### "Missing environment variable"

**Check**:
1. File is named `.env.local` (not `.env` or `env.local`)
2. File is in project root (same level as `package.json`)
3. No spaces around `=` in variable assignment
4. Restarted dev server after adding variables

### "Invalid API key format"

**Check**:
1. Clerk: Should start with `pk_test_` or `pk_live_`
2. Google AI: Should start with `AIza`
3. Stripe: Should start with `sk_test_` or `sk_live_`
4. No extra quotes or spaces in the value

### "Variable not available in frontend"

**Check**:
1. Must have `NEXT_PUBLIC_` prefix for frontend access
2. Without prefix = backend only
3. Restart Next.js after adding `NEXT_PUBLIC_` variables

### "Works locally but not in production"

**Check**:
1. Production env vars set in hosting platform (Vercel, etc.)
2. Using production keys (not test keys)
3. All required variables copied over
4. No typo in variable names

---

## Service-Specific Setup Guides

### Convex Setup

1. **Install CLI**:
   ```bash
   npm install -g convex
   ```

2. **Initialize Project**:
   ```bash
   npx convex dev
   ```

3. **Copy URL**:
   - After initialization, copy the deployment URL
   - Add to `.env.local` as `NEXT_PUBLIC_CONVEX_URL`

4. **Verify**:
   ```bash
   npx convex status
   ```

### Clerk Setup

1. **Create Application**:
   - Go to [Clerk Dashboard](https://dashboard.clerk.com)
   - Click "Create Application"
   - Choose "Next.js" framework

2. **Copy Keys**:
   - Dashboard → API Keys
   - Copy publishable and secret keys

3. **Configure URLs**:
   - Dashboard → Configure → URLs
   - Set redirect URLs:
     - Dev: `http://localhost:3000/dashboard`
     - Prod: `https://yourdomain.com/dashboard`

4. **Enable OAuth (Optional)**:
   - Dashboard → User & Authentication → Social Connections
   - Enable Google, GitHub, etc.

### Google AI Setup

1. **Get API Key**:
   - Go to [Google AI Studio](https://aistudio.google.com/app/apikey)
   - Sign in with Google
   - Click "Create API Key"

2. **Add to Project**:
   ```bash
   echo "GOOGLE_AI_API_KEY=your-key" >> .env.local
   ```

3. **Test**:
   - Try AI generation in app
   - Check [Google AI Console](https://console.cloud.google.com) for usage

### Stripe Setup (Phase 5)

1. **Create Account**:
   - Go to [Stripe Dashboard](https://dashboard.stripe.com)
   - Complete onboarding

2. **Get API Keys**:
   - Developers → API Keys
   - Copy test keys first (for development)

3. **Set Up Webhooks**:
   - Developers → Webhooks
   - Add endpoint: `https://yourdomain.com/api/webhooks/stripe`
   - Select events (see above)
   - Copy signing secret

4. **Create Products**:
   - Products → Create Product
   - Set up pricing tiers (Pro, Team)
   - Note price IDs for code

---

*Keep this file updated when adding new integrations. For setup issues, see [02-SETUP.md](./02-SETUP.md) or [11-TROUBLESHOOTING.md](./11-TROUBLESHOOTING.md).*
